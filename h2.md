# h2 Break & unbreak

## x) Tiivistelmät

### OWASP: OWASP Top 10

- Huono access control suurin uhka
- Aina vähimmillä oikeuksilla tai deny by default, kun mahdollista
- Pelkkää URLia muuttamalla voi päästä huonosti piilotettuihin/suojattuihin tietoihin käsiksi

### Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf

- ffuf voi löytää salaisia URLeja helposti
- Yleisten web-osoitteiden sanakirjalla ffuf kokeilee mahdollisuuksia huippunopeudella
- Filtteröimällä saa väärät positiivit pois

### PortSwigger: Access control vulnerabilities and privilege escalation

- Access controllia on vertical ja horizontal: Vertical on esim. Admin voi poistaa muita käyttäjiä, normaalit käyttäjät ei. Horizontal on esim. pankkitilit voivat kaikki tehdä maksuja ja tarkastella omaa tiliään, mutta eivät muiden.
- Privilege escalation on sitä, kun käyttäjä pääsee tekemään asioita mitä ei olisi tarkoitus, esim. Pääsy admin-tason tiedostoihin ilman admin-oikeuksia.

### Karvinen 2006: Raportin kirjoittaminen

- Raportin pitää olla toistettava, täsmällinena ja helppolukuinen.
- Raportin tulee viitata lähteisin oikein.
- Raportissa tulee olla vakiotekstit, esim. lisenssi.

## a) Murtaudu 010-staff-only.

Asensin tehtävän Kali Linuxille:

    $ sudo apt-get update
    $ sudo apt-get -y install wget unzip micro
    $ wget https://terokarvinen.com/hack-n-fix/teros-challenges.zip
    $ unzip teros-challenges.zip

Käynnistin tehtävän:

    $ cd challenges/010-staff-only/
    $ sudo apt-get -y install python3-flask python3-flask-sqlalchemy
    $ python3 staff-only.py

Avasin tehtävän selaimella osoitteesta http://127.0.0.1:5000

Kokeilin tuntemiani SQL-injektiometodeja, kuten OR 1=1, mutta en keksinyt miten tehtävä tulee ratkaista. Kokemukseni SQL-injektioista ovat hyvin vähäiset Lopuksi luovutin, ja katsoin ratkaisun annetusta [Walkthroughsta.](https://askdatdude.github.io/diary/entries/diary.html?entry=SH24-002&week=) 

Vastaus on SUPERADMIN%%rootALL-FLAG{Tero-e45f8764675e4463db969473b6d0fcdd}

## b) Korjaa 010-staff-only haavoittuvuus lähdekoodista

Tähän tehtävään minulla ei ollut mitään hajua miten pureutua, ja toivonkin että se käydään tarkemmin tunnilla läpi. Ei sitten mitään käryä.

## c) Ratkaise dirfuzt-1

Latasin ffufin komennolla

    $ sudo apt-get install ffuf

Ja käynnistin halutun maalin komennoilla

    $ wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-0
    $ chmod u+x dirfuzt-0
    $ ./dirfuzt-0

Lähdin kokeilemaan ffufia:

    $ ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ

Mutta tuloksia tuli tuhansia, joten rajasin komentoa lisäämällä filtterin -fs 154, joka toimi.

Flagi: FLAG{tero-git-3cc87212bcd311686a3b9e547d47fc51}

## d) Murtaudu 020-your-eyes-only

Omat taitoni eivät riittäneet tehtävään

## e) Korjaa haavoittuvuus

Sama ongelma kuin edellisessä.

## Lähteet

Karvinen, Iso-Anttila 2025: [Sovellusten Hakkerointi](https://terokarvinen.com/sovellusten-hakkerointi/#h2-break--unbreak-tero)

OWASP: [Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

Karvinen 2023: [Find Hidden Web Directories - Fuzz URLs with ffuf](https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/)

PortSwigger: [Access control vulnerabilities and privilege escalation](https://portswigger.net/web-security/access-control)

Karvinen 2006: [Raportin kirjoittaminen](https://terokarvinen.com/2006/raportin-kirjoittaminen-4/)

